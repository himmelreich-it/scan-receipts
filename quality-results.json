{
  "timestamp": "2025-09-16T19:56:17.298554",
  "tools": {
    "ruff_src": {
      "success": true,
      "output": "All checks passed!\n",
      "errors": ""
    },
    "ruff_tests": {
      "success": true,
      "output": "All checks passed!\n",
      "errors": ""
    },
    "pyright": {
      "success": true,
      "output": "0 errors, 0 warnings, 0 informations\n",
      "errors": ""
    },
    "unit_tests": {
      "success": true,
      "output": "============================= test session starts ==============================\nplatform linux -- Python 3.13.7, pytest-8.4.1, pluggy-1.6.0 -- /home/oskar/code/himm/scan-receipts/.venv/bin/python\ncachedir: .pytest_cache\nrootdir: /home/oskar/code/himm/scan-receipts\nconfigfile: pytest.ini\nplugins: asyncio-1.0.0, cov-6.2.1, anyio-4.9.0, mock-3.15.0\nasyncio: mode=Mode.AUTO, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function\ncollecting ... collected 71 items\n\ntests/unit/test_config.py::TestAppConfig::test_from_env_with_all_variables PASSED [  1%]\ntests/unit/test_config.py::TestAppConfig::test_from_env_missing_single_variable PASSED [  2%]\ntests/unit/test_config.py::TestAppConfig::test_from_env_missing_multiple_variables PASSED [  4%]\ntests/unit/test_config.py::TestAppConfig::test_from_env_all_missing PASSED [  5%]\ntests/unit/test_config.py::TestAppConfig::test_config_immutability PASSED [  7%]\ntests/unit/test_csv_adapter.py::TestCSVAdapter::test_read_staging_table_file_not_exists PASSED [  8%]\ntests/unit/test_csv_adapter.py::TestCSVAdapter::test_read_staging_table_empty_file PASSED [  9%]\ntests/unit/test_csv_adapter.py::TestCSVAdapter::test_read_staging_table_with_headers_only PASSED [ 11%]\ntests/unit/test_csv_adapter.py::TestCSVAdapter::test_read_staging_table_with_data PASSED [ 12%]\ntests/unit/test_csv_adapter.py::TestCSVAdapter::test_read_staging_table_with_missing_columns PASSED [ 14%]\ntests/unit/test_domain_entities.py::TestFileHash::test_file_hash_creation PASSED [ 15%]\ntests/unit/test_domain_entities.py::TestFileHash::test_file_hash_empty_hash_raises_error PASSED [ 16%]\ntests/unit/test_domain_entities.py::TestFileHash::test_file_hash_whitespace_hash_raises_error PASSED [ 18%]\ntests/unit/test_domain_entities.py::TestFileHash::test_file_hash_immutable PASSED [ 19%]\ntests/unit/test_domain_entities.py::TestDuplicateDetectionResult::test_duplicate_detection_result_no_duplicate PASSED [ 21%]\ntests/unit/test_domain_entities.py::TestDuplicateDetectionResult::test_duplicate_detection_result_with_duplicate PASSED [ 22%]\ntests/unit/test_domain_entities.py::TestDuplicateDetectionResult::test_duplicate_detection_result_with_error PASSED [ 23%]\ntests/unit/test_domain_entities.py::TestDuplicateDetectionResult::test_location_name_with_duplicate_location PASSED [ 25%]\ntests/unit/test_domain_entities.py::TestDuplicateDetectionResult::test_location_name_without_duplicate_location PASSED [ 26%]\ntests/unit/test_domain_entities.py::TestDuplicateDetectionResult::test_duplicate_detection_result_immutable PASSED [ 28%]\ntests/unit/test_duplicate_detection_adapter.py::TestDuplicateDetectionAdapter::test_check_duplicate_no_existing_hashes PASSED [ 29%]\ntests/unit/test_duplicate_detection_adapter.py::TestDuplicateDetectionAdapter::test_check_duplicate_no_match PASSED [ 30%]\ntests/unit/test_duplicate_detection_adapter.py::TestDuplicateDetectionAdapter::test_check_duplicate_with_match PASSED [ 32%]\ntests/unit/test_duplicate_detection_adapter.py::TestDuplicateDetectionAdapter::test_check_duplicate_hash_calculation_fails PASSED [ 33%]\ntests/unit/test_duplicate_detection_adapter.py::TestDuplicateDetectionAdapter::test_check_duplicate_exception_handling PASSED [ 35%]\ntests/unit/test_duplicate_detection_adapter.py::TestDuplicateDetectionAdapter::test_check_duplicate_first_match_wins PASSED [ 36%]\ntests/unit/test_duplicate_detection_adapter.py::TestDuplicateDetectionAdapter::test_check_duplicate_multiple_hashes_no_match PASSED [ 38%]\ntests/unit/test_file_system_adapter.py::TestFileSystemAdapter::test_get_supported_files_empty_folder PASSED [ 39%]\ntests/unit/test_file_system_adapter.py::TestFileSystemAdapter::test_get_supported_files_nonexistent_folder PASSED [ 40%]\ntests/unit/test_file_system_adapter.py::TestFileSystemAdapter::test_get_supported_files_with_supported_files PASSED [ 42%]\ntests/unit/test_file_system_adapter.py::TestFileSystemAdapter::test_remove_file_if_exists_existing_file PASSED [ 43%]\ntests/unit/test_file_system_adapter.py::TestFileSystemAdapter::test_remove_file_if_exists_nonexistent_file PASSED [ 45%]\ntests/unit/test_file_system_adapter.py::TestFileSystemAdapter::test_clear_folder_with_files PASSED [ 46%]\ntests/unit/test_file_system_adapter.py::TestFileSystemAdapter::test_clear_folder_nonexistent_folder PASSED [ 47%]\ntests/unit/test_file_system_adapter.py::TestFileSystemAdapter::test_clear_folder_empty_folder PASSED [ 49%]\ntests/unit/test_file_system_adapter.py::TestFileSystemAdapter::test_calculate_file_hash_existing_file PASSED [ 50%]\ntests/unit/test_file_system_adapter.py::TestFileSystemAdapter::test_calculate_file_hash_nonexistent_file PASSED [ 52%]\ntests/unit/test_file_system_adapter.py::TestFileSystemAdapter::test_calculate_file_hash_consistent_results PASSED [ 53%]\ntests/unit/test_file_system_adapter.py::TestFileSystemAdapter::test_calculate_file_hash_different_content_different_hash PASSED [ 54%]\ntests/unit/test_file_system_adapter.py::TestFileSystemAdapter::test_get_file_hashes_from_folder_empty_folder PASSED [ 56%]\ntests/unit/test_file_system_adapter.py::TestFileSystemAdapter::test_get_file_hashes_from_folder_nonexistent_folder PASSED [ 57%]\ntests/unit/test_file_system_adapter.py::TestFileSystemAdapter::test_get_file_hashes_from_folder_with_supported_files PASSED [ 59%]\ntests/unit/test_folders.py::TestCreateFolders::test_create_folders_success PASSED [ 60%]\ntests/unit/test_folders.py::TestCreateFolders::test_create_folders_with_nested_paths PASSED [ 61%]\ntests/unit/test_folders.py::TestCreateFolders::test_create_folders_existing_folders PASSED [ 63%]\ntests/unit/test_folders.py::TestCreateFolders::test_create_folders_permission_error PASSED [ 64%]\ntests/unit/test_folders.py::TestCountReceiptFiles::test_count_receipt_files_empty_folder PASSED [ 66%]\ntests/unit/test_folders.py::TestCountReceiptFiles::test_count_receipt_files_with_receipts PASSED [ 67%]\ntests/unit/test_folders.py::TestCountReceiptFiles::test_count_receipt_files_mixed_files PASSED [ 69%]\ntests/unit/test_folders.py::TestCountReceiptFiles::test_count_receipt_files_ignores_subdirectories PASSED [ 70%]\ntests/unit/test_folders.py::TestCountReceiptFiles::test_count_receipt_files_nonexistent_folder PASSED [ 71%]\ntests/unit/test_folders.py::TestGetStagingInfo::test_get_staging_info_missing_file PASSED [ 73%]\ntests/unit/test_folders.py::TestGetStagingInfo::test_get_staging_info_empty_csv PASSED [ 74%]\ntests/unit/test_folders.py::TestGetStagingInfo::test_get_staging_info_with_header_only PASSED [ 76%]\ntests/unit/test_folders.py::TestGetStagingInfo::test_get_staging_info_with_entries PASSED [ 77%]\ntests/unit/test_folders.py::TestGetStagingInfo::test_staging_info_string_format PASSED [ 78%]\ntests/unit/test_main.py::TestSignalHandler::test_signal_handler_exits PASSED [ 80%]\ntests/unit/test_main.py::TestHandleMenuChoice::test_handle_menu_choice_option_1 PASSED [ 81%]\ntests/unit/test_main.py::TestHandleMenuChoice::test_handle_menu_choice_option_2 PASSED [ 83%]\ntests/unit/test_main.py::TestHandleMenuChoice::test_handle_menu_choice_option_3 PASSED [ 84%]\ntests/unit/test_main.py::TestHandleMenuChoice::test_handle_menu_choice_option_4 PASSED [ 85%]\ntests/unit/test_main.py::TestHandleMenuChoice::test_handle_menu_choice_invalid PASSED [ 87%]\ntests/unit/test_main.py::TestDisplayStatus::test_display_status_shows_configured_paths PASSED [ 88%]\ntests/unit/test_main.py::TestDisplayStatus::test_display_status_shows_file_counts_after_paths PASSED [ 90%]\ntests/unit/test_main.py::TestDisplayStatus::test_display_status_converts_relative_paths_to_absolute PASSED [ 91%]\ntests/unit/test_process_receipt_use_case.py::TestProcessReceiptUseCase::test_execute_no_files PASSED [ 92%]\ntests/unit/test_process_receipt_use_case.py::TestProcessReceiptUseCase::test_execute_with_files PASSED [ 94%]\ntests/unit/test_process_receipt_use_case.py::TestProcessReceiptUseCase::test_execute_handles_missing_receipts_csv PASSED [ 95%]\ntests/unit/test_view_staging_use_case.py::TestViewStagingUseCase::test_get_full_table_file_not_exists PASSED [ 97%]\ntests/unit/test_view_staging_use_case.py::TestViewStagingUseCase::test_get_full_table_with_data PASSED [ 98%]\ntests/unit/test_view_staging_use_case.py::TestViewStagingUseCase::test_get_full_table_error_handling PASSED [100%]\n\n============================== 71 passed in 0.19s ==============================\n",
      "errors": ""
    },
    "integration_tests": {
      "success": true,
      "output": "============================= test session starts ==============================\nplatform linux -- Python 3.13.7, pytest-8.4.1, pluggy-1.6.0 -- /home/oskar/code/himm/scan-receipts/.venv/bin/python\ncachedir: .pytest_cache\nrootdir: /home/oskar/code/himm/scan-receipts\nconfigfile: pytest.ini\nplugins: asyncio-1.0.0, cov-6.2.1, anyio-4.9.0, mock-3.15.0\nasyncio: mode=Mode.AUTO, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function\ncollecting ... collected 18 items\n\ntests/integration/test_duplicate_detection_integration.py::TestDuplicateDetectionIntegration::test_duplicate_detection_with_real_files PASSED [  5%]\ntests/integration/test_duplicate_detection_integration.py::TestDuplicateDetectionIntegration::test_duplicate_detection_different_files PASSED [ 11%]\ntests/integration/test_duplicate_detection_integration.py::TestDuplicateDetectionIntegration::test_process_receipt_use_case_skips_duplicates PASSED [ 16%]\ntests/integration/test_duplicate_detection_integration.py::TestDuplicateDetectionIntegration::test_get_existing_hashes_from_both_folders PASSED [ 22%]\ntests/integration/test_duplicate_detection_integration.py::TestDuplicateDetectionIntegration::test_hash_calculation_error_handling PASSED [ 27%]\ntests/integration/test_run_analysis_integration.py::TestRunAnalysisIntegration::test_run_analysis_no_files PASSED [ 33%]\ntests/integration/test_run_analysis_integration.py::TestRunAnalysisIntegration::test_run_analysis_with_files PASSED [ 38%]\ntests/integration/test_run_analysis_integration.py::TestRunAnalysisIntegration::test_run_analysis_rerun_scenario PASSED [ 44%]\ntests/integration/test_staging_table_integration.py::TestStagingTableIntegration::test_display_staging_table_file_not_exists PASSED [ 50%]\ntests/integration/test_staging_table_integration.py::TestStagingTableIntegration::test_display_staging_table_empty_file PASSED [ 55%]\ntests/integration/test_staging_table_integration.py::TestStagingTableIntegration::test_display_staging_table_with_data PASSED [ 61%]\ntests/integration/test_staging_table_integration.py::TestStagingTableIntegration::test_menu_choice_3_triggers_staging_table_display PASSED [ 66%]\ntests/integration/test_staging_table_integration.py::TestStagingTableIntegration::test_end_to_end_flow PASSED [ 72%]\ntests/integration/test_tui_integration.py::TestTUIIntegration::test_full_configuration_and_folder_creation PASSED [ 77%]\ntests/integration/test_tui_integration.py::TestTUIIntegration::test_startup_display_with_no_data PASSED [ 83%]\ntests/integration/test_tui_integration.py::TestTUIIntegration::test_startup_display_with_files_and_staging PASSED [ 88%]\ntests/integration/test_tui_integration.py::TestTUIIntegration::test_environment_validation_fail_fast PASSED [ 94%]\ntests/integration/test_tui_integration.py::TestTUIIntegration::test_folder_creation_with_permissions_error PASSED [100%]\n\n============================== 18 passed in 0.06s ==============================\n",
      "errors": ""
    },
    "behave": {
      "success": false,
      "output": "USING RUNNER: behave.runner:Runner\nFeature: Duplicate Detection During Analysis\n  As a user\n  I want the system to skip duplicate files during analysis\n  So that I avoid unnecessary API calls and processing time\n  Feature: Duplicate Detection During Analysis \n\n  Scenario: Skip file that exists in imported folder \n    Given the system is initialized with test folders\n    And the incoming folder contains some receipt files\n    And the CSV staging file is cleared\n    Given a receipt file \"receipt1.pdf\" exists in the incoming folder\n    And an identical file \"existing1.pdf\" exists in the imported folder\n    When I run the receipt analysis\n    Then the system should detect the duplicate\n    And the file should be skipped with a message about \"imported\" folder\n    And no AI analysis should be performed for this file\n\n  Scenario: Skip file that exists in scanned folder \n    Given the system is initialized with test folders\n    And the incoming folder contains some receipt files\n    And the CSV staging file is cleared\n    Given a receipt file \"receipt2.pdf\" exists in the incoming folder\n    And an identical file \"processed2.pdf\" exists in the scanned folder\n    When I run the receipt analysis\n    Then the system should detect the duplicate\n      ASSERT FAILED:\n\n    And the file should be skipped with a message about \"scanned\" folder\n    And no AI analysis should be performed for this file\n\n  Scenario: Process unique file normally \n    Given the system is initialized with test folders\n    And the incoming folder contains some receipt files\n    And the CSV staging file is cleared\n    Given a receipt file \"unique.pdf\" exists in the incoming folder\n    And no duplicate exists in imported or scanned folders\n    When I run the receipt analysis\n    Then the system should not detect any duplicates\n    And the file should proceed to AI analysis\n\n  Scenario: Handle hash calculation error gracefully \n    Given the system is initialized with test folders\n    And the incoming folder contains some receipt files\n    And the CSV staging file is cleared\n    Given a corrupted file \"corrupted.pdf\" exists in the incoming folder\n    When I run the receipt analysis\n    Then the system should display a hash calculation error\n      ASSERT FAILED:\n\n    And the system should continue processing remaining files\n\n  Scenario: Process mix of duplicate and unique files \n    Given the system is initialized with test folders\n    And the incoming folder contains some receipt files\n    And the CSV staging file is cleared\n    Given multiple files exist in the incoming folder:\n      | filename     | has_duplicate | duplicate_location |\n      | receipt1.pdf | yes           | imported           |\n      | receipt2.pdf | yes           | scanned            |\n      | unique1.pdf  | no            |                    |\n      | unique2.pdf  | no            |                    |\n    When I run the receipt analysis\n    Then the system should show a summary:\n      | processed | duplicates_skipped | errors |\n      | 2         | 2                  | 0      |\n      ASSERT FAILED:\n\n\n  Scenario: Continue processing after hash calculation errors \n    Given the system is initialized with test folders\n    And the incoming folder contains some receipt files\n    And the CSV staging file is cleared\n    Given multiple files exist in the incoming folder:\n      | filename      | type      |\n      | valid1.pdf    | valid     |\n      | corrupted.pdf | corrupted |\n      | valid2.pdf    | valid     |\n    When I run the receipt analysis\n    Then the system should show a summary with:\n      | processed | duplicates_skipped | errors |\n      | 2         | 0                  | 1      |\n      ASSERT FAILED:\n\n\nFeature: Run Analysis - Initial Implementation\n  As a user of the receipt processor\n  I want to run analysis on receipt files\n  So that I can process receipts with clear progress feedback\n  Feature: Run Analysis - Initial Implementation \n\n  Scenario: Menu shows \"Run Analysis\" when receipts.csv doesn't exist \n    Given the application environment is properly configured\n    And required folders exist\n    Given no receipts.csv file exists\n    When the application displays the menu\n    Then it should show \"[1] Run Analysis\"\n\n  Scenario: Menu shows \"Re-run Analysis\" when receipts.csv exists \n    Given the application environment is properly configured\n    And required folders exist\n    Given a receipts.csv file exists\n    When the application displays the menu\n    Then it should show \"[1] Re-run Analysis\"\n\n  Scenario: Run Analysis with no supported files \n    Given the application environment is properly configured\n    And required folders exist\n    Given no supported files exist in the incoming folder\n    When the user selects \"Run Analysis\"\n    Then it should display \"No files in {incoming} folder\"\n    And return to the main menu\n\n  Scenario: Run Analysis with supported files \n    Given the application environment is properly configured\n    And required folders exist\n    Given 3 supported files exist in the incoming folder:\n      | filename     |\n      | receipt1.pdf |\n      | receipt2.jpg |\n      | receipt3.png |\n    When the user selects \"Run Analysis\"\n    Then it should display progress messages:\n      | message                      |\n      | Processing 1/3: receipt1.pdf |\n      | Processing 2/3: receipt2.jpg |\n      | Processing 3/3: receipt3.png |\n    And display \"TODO: Implement actual processing\"\n      ASSERT FAILED:\n\n    And return to the main menu\n\n  Scenario: Re-run Analysis clears existing data \n    Given the application environment is properly configured\n    And required folders exist\n    Given a receipts.csv file exists with data\n    And the scanned folder contains files:\n      | filename        |\n      | old_receipt.jpg |\n      | old_receipt.pdf |\n    And 2 supported files exist in the incoming folder:\n      | filename |\n      | new1.pdf |\n      | new2.jpg |\n    When the user selects \"Re-run Analysis\"\n    Then the receipts.csv file should be removed\n    And the scanned folder should be cleared\n    And it should display progress messages:\n      | message                  |\n      | Processing 1/2: new1.pdf |\n      | Processing 2/2: new2.jpg |\n    And display \"TODO: Implement actual processing\"\n      ASSERT FAILED:\n\n\n  Scenario: Run Analysis handles mixed file types \n    Given the application environment is properly configured\n    And required folders exist\n    Given files exist in the incoming folder:\n      | filename         | supported |\n      | receipt.pdf      | yes       |\n      | image.jpg        | yes       |\n      | document.txt     | no        |\n      | photo.png        | yes       |\n      | spreadsheet.xlsx | no        |\n    When the user selects \"Run Analysis\"\n    Then it should display progress messages for 3 supported files only\n      ASSERT FAILED:\n\n    And display \"TODO: Implement actual processing\"\n\n  Scenario: Run Analysis with unsupported files only \n    Given the application environment is properly configured\n    And required folders exist\n    Given files exist in the incoming folder:\n      | filename         |\n      | document.txt     |\n      | spreadsheet.xlsx |\n      | readme.md        |\n    When the user selects \"Run Analysis\"\n    Then it should display \"No files in {incoming} folder\"\n    And return to the main menu\n\nFeature: TUI Interface with System Status and Menu\n  As a user of the receipt processor\n  I want a TUI showing system status and menu options\n  So that I can see receipt counts and navigate features\n  Scenario: Configuration validation fails with missing environment variables \n    Given no environment variables are set\n    When the application starts\n    Then it should fail with \"Missing environment variables\"\n    And list all 6 missing variables\n\n  Scenario: Successful startup with all environment variables \n    Given all required environment variables are set\n    When the application starts\n    Then all 4 folders should be created if missing\n    And the TUI should display successfully\n\n  Scenario: Display system status with no data \n    Given the application is running\n    And no receipt files exist\n    And no staging CSV exists\n    When the status is displayed\n    Then it should show configured folder paths\n    And show \"Input Folder: 0 files\"\n    And show \"Failed Folder: 0 files\"\n    And show \"Staging: No staging data\"\n\n  Scenario: Display system status with receipt files \n    Given the application is running\n    And 15 files exist in the incoming folder\n    And 2 files exist in the failed folder\n    And staging CSV contains 8 entries\n    When the status is displayed\n    Then it should show configured folder paths\n    And show \"Input Folder: 15 files\"\n    And show \"Failed Folder: 2 files\"\n    And show staging file with \"8 entries\"\n\n  Scenario: Navigate menu options 1-3 \n    Given the application is running\n    When the user selects option 1\nAnalysis completed.\n\n\n    Then it should display \"Not yet implemented...\"\n    And return to the menu\n    When the user selects option 2\nImport completed.\n\n\n    Then it should display \"Not yet implemented...\"\n    And return to the menu\n    When the user selects option 3\nreceipts.csv is empty\n\n\n    Then it should display \"Not yet implemented...\"\n    And return to the menu\n\n  Scenario: Exit application with option 4 \n    Given the application is running\n    When the user selects option 4\nGoodbye\n    Then it should display \"Goodbye\"\n    And exit the application\n\n  Scenario: Handle invalid menu input \n    Given the application is running\n    When the user enters invalid input \"5\"\nInvalid choice. Please enter 1-4.\n\n\n    Then it should display error message\n    And re-prompt for input\n    When the user enters invalid input \"abc\"\nInvalid choice. Please enter 1-4.\n\n\n    Then it should display error message\n    And re-prompt for input\n\n  Scenario: Handle Ctrl+C gracefully \n    Given the application is running\n    When the user presses Ctrl+C\n\nGoodbye\n    Then it should display \"Goodbye\"\n    And exit cleanly\n\n  Scenario: Display configured folder paths on startup \n    Given the application is running with test configuration\n    When the status is displayed\n    Then it should show all 6 configured paths as absolute paths\n    And paths should have short labels\n    And paths should be displayed above file counts\n\nFeature: View Staging Table functionality\n  As a user of the receipt processor\n  I want to view the staging table contents\n  So that I can see all processed receipts before importing to XLSX\n  Scenario: View staging table when CSV file does not exist \n    Given the application is running\n    And the receipts.csv file does not exist\n    When the user selects \"View Staging Table\"\n    Then it should display \"receipts.csv does not exist\"\n    And return to the main menu\n\n  Scenario: View staging table when CSV file is empty \n    Given the application is running\n    And the receipts.csv file exists but is empty\n    When the user selects \"View Staging Table\"\n    Then it should display \"receipts.csv is empty\"\n    And return to the main menu\n\n  Scenario: View staging table with receipt data \n    Given the application is running\n    And the receipts.csv file exists with data:\n      | Amount | Tax   | TaxPercentage | Description    | Currency | Date       | Confidence | Hash   | DoneFilename    |\n      | 100.00 | 10.00 | 10            | Coffee Receipt | USD      | 2024-01-01 | 0.95       | abc123 | receipt_001.pdf |\n      | 200.00 | 20.00 | 10            | Lunch Receipt  | EUR      | 2024-01-02 | 0.90       | def456 | receipt_002.pdf |\n    When the user selects \"View Staging Table\"\n    Then it should display a formatted table with headers:\n      | Amount | Tax | TaxPercentage | Description | Currency | Date | Confidence | Hash | DoneFilename |\n      ASSERT FAILED:\n\n    And the table should contain the receipt data\n    And it should show \"Total entries: 2\"\n    And return to the main menu\n\n  Scenario: View staging table with large hash values \n    Given the application is running\n    And the receipts.csv file exists with data:\n      | Amount | Tax  | TaxPercentage | Description   | Currency | Date       | Confidence | Hash            | DoneFilename    |\n      | 50.00  | 5.00 | 10            | Store Receipt | USD      | 2024-01-03 | 0.99       | abcdef123456789 | receipt_003.pdf |\n    When the user selects \"View Staging Table\"\n    Then it should display a formatted table\n    And the Hash column should show \"abcdef12...\" for long hashes\n      ASSERT FAILED:\n\n    And return to the main menu\n\n  Scenario: Handle CSV parsing errors gracefully \n    Given the application is running\n    And the receipts.csv file exists but is corrupted\n    When the user selects \"View Staging Table\"\n    Then it should display \"Error reading staging table.\"\n    And return to the main menu\n\n\nFailing scenarios:\n  tests/bdd/features/run_analysis.feature:26  Run Analysis with supported files\n  tests/bdd/features/run_analysis.feature:41  Re-run Analysis clears existing data\n  tests/bdd/features/run_analysis.feature:60  Run Analysis handles mixed file types\n\nErrored scenarios:\n  tests/bdd/features/duplicate_detection.feature:11  Skip file that exists in imported folder\n  tests/bdd/features/duplicate_detection.feature:19  Skip file that exists in scanned folder\n  tests/bdd/features/duplicate_detection.feature:27  Process unique file normally\n  tests/bdd/features/duplicate_detection.feature:34  Handle hash calculation error gracefully\n  tests/bdd/features/duplicate_detection.feature:40  Process mix of duplicate and unique files\n  tests/bdd/features/duplicate_detection.feature:52  Continue processing after hash calculation errors\n  tests/bdd/features/tui_interface.feature:12  Successful startup with all environment variables\n  tests/bdd/features/tui_interface.feature:18  Display system status with no data\n  tests/bdd/features/tui_interface.feature:28  Display system status with receipt files\n  tests/bdd/features/tui_interface.feature:39  Navigate menu options 1-3\n  tests/bdd/features/tui_interface.feature:51  Exit application with option 4\n  tests/bdd/features/tui_interface.feature:57  Handle invalid menu input\n  tests/bdd/features/tui_interface.feature:66  Handle Ctrl+C gracefully\n  tests/bdd/features/tui_interface.feature:72  Display configured folder paths on startup\n  tests/bdd/features/view_staging_table.feature:6  View staging table when CSV file does not exist\n  tests/bdd/features/view_staging_table.feature:13  View staging table when CSV file is empty\n  tests/bdd/features/view_staging_table.feature:20  View staging table with receipt data\n  tests/bdd/features/view_staging_table.feature:33  View staging table with large hash values\n  tests/bdd/features/view_staging_table.feature:43  Handle CSV parsing errors gracefully\n\n0 features passed, 1 failed, 3 error, 0 skipped\n5 scenarios passed, 3 failed, 19 cleanup_error, 0 skipped\n155 steps passed, 9 failed, 9 skipped\nTook 0min 0.075s\n",
      "errors": "/home/oskar/code/himm/scan-receipts/.venv/lib/python3.13/site-packages/behave/model.py:1989: ContextMaskWarning: behave runner is masking context attribute 'text' originally set in  (:1)\n  runner.context.text = self.text\n/home/oskar/code/himm/scan-receipts/.venv/lib/python3.13/site-packages/behave/model.py:1990: ContextMaskWarning: behave runner is masking context attribute 'table' originally set in  (:1)\n  runner.context.table = self.table\ntests/bdd/steps/duplicate_detection_steps.py:24: ContextMaskWarning: user code is masking context attribute 'failed' originally set by behave\n  context.failed = context.temp_dir / \"failed\"\ntests/bdd/steps/duplicate_detection_steps.py:32: ContextMaskWarning: user code is masking context attribute 'config' originally set by behave\n  context.config = AppConfig(\n/home/oskar/code/himm/scan-receipts/.venv/lib/python3.13/site-packages/behave/model.py:1989: ContextMaskWarning: behave runner is masking context attribute 'text' originally set in runner.context.text = self.text (/home/oskar/code/himm/scan-receipts/.venv/lib/python3.13/site-packages/behave/model.py:1989)\n  runner.context.text = self.text\n/home/oskar/code/himm/scan-receipts/.venv/lib/python3.13/site-packages/behave/model.py:1990: ContextMaskWarning: behave runner is masking context attribute 'table' originally set in runner.context.table = self.table (/home/oskar/code/himm/scan-receipts/.venv/lib/python3.13/site-packages/behave/model.py:1990)\n  runner.context.table = self.table\nLOG_INFO:core.use_cases.process_receipt: Starting receipt analysis\nLOG_INFO:core.use_cases.process_receipt: Cleared scanned folder\nLOG_INFO:core.use_cases.process_receipt: Found 1 hashes in imported folder\nLOG_INFO:core.use_cases.process_receipt: Found 0 hashes in scanned folder\nLOG_INFO:adapters.secondary.duplicate_detection_adapter: Duplicate detected: receipt1.pdf matches /tmp/tmpza8qazon/imported/existing1.pdf\nLOG_INFO:core.use_cases.process_receipt: Receipt analysis completed - processed: 0, duplicates: 1, errors: 0\n/home/oskar/code/himm/scan-receipts/.venv/lib/python3.13/site-packages/behave/model.py:1154: ContextMaskWarning: behave runner is masking context attribute 'tags' originally set in  (:1)\n  runner.context.tags = set(self.effective_tags)\nLOG_INFO:core.use_cases.process_receipt: Starting receipt analysis\nLOG_INFO:core.use_cases.process_receipt: Cleared scanned folder\nLOG_INFO:core.use_cases.process_receipt: Found 0 hashes in imported folder\nLOG_INFO:core.use_cases.process_receipt: Found 0 hashes in scanned folder\nLOG_INFO:core.use_cases.process_receipt: Receipt analysis completed - processed: 1, duplicates: 0, errors: 0\n/home/oskar/code/himm/scan-receipts/.venv/lib/python3.13/site-packages/behave/model.py:1199: ContextMaskWarning: behave runner is masking context attribute 'failed' originally set in context.failed = context.temp_dir / \"failed\" (tests/bdd/steps/duplicate_detection_steps.py:24)\n  runner.context._set_root_attribute(\"failed\", True)\nLOG_INFO:core.use_cases.process_receipt: Starting receipt analysis\nLOG_INFO:core.use_cases.process_receipt: Cleared scanned folder\nLOG_INFO:core.use_cases.process_receipt: Found 0 hashes in imported folder\nLOG_INFO:core.use_cases.process_receipt: Found 0 hashes in scanned folder\nLOG_INFO:core.use_cases.process_receipt: Receipt analysis completed - processed: 1, duplicates: 0, errors: 0\nLOG_INFO:core.use_cases.process_receipt: Starting receipt analysis\nLOG_INFO:core.use_cases.process_receipt: Starting receipt analysis\nLOG_INFO:core.use_cases.process_receipt: Cleared scanned folder\nLOG_INFO:core.use_cases.process_receipt: Found 1 hashes in imported folder\nLOG_INFO:core.use_cases.process_receipt: Found 0 hashes in scanned folder\nLOG_INFO:adapters.secondary.duplicate_detection_adapter: Duplicate detected: receipt1.pdf matches /tmp/tmpitl8b8g6/imported/dup_receipt1.pdf\nLOG_INFO:core.use_cases.process_receipt: Receipt analysis completed - processed: 3, duplicates: 1, errors: 0\nLOG_INFO:core.use_cases.process_receipt: Starting receipt analysis\nLOG_INFO:core.use_cases.process_receipt: Cleared scanned folder\nLOG_INFO:core.use_cases.process_receipt: Found 0 hashes in imported folder\nLOG_INFO:core.use_cases.process_receipt: Found 0 hashes in scanned folder\nLOG_INFO:core.use_cases.process_receipt: Receipt analysis completed - processed: 2, duplicates: 0, errors: 0\n/home/oskar/code/himm/scan-receipts/.venv/lib/python3.13/site-packages/behave/model.py:571: ContextMaskWarning: behave runner is masking context attribute 'feature' originally set in  (:1)\n  context.feature = self\n/home/oskar/code/himm/scan-receipts/.venv/lib/python3.13/site-packages/behave/model.py:1154: ContextMaskWarning: behave runner is masking context attribute 'tags' originally set in runner.context.tags = set(self.tags) (/home/oskar/code/himm/scan-receipts/.venv/lib/python3.13/site-packages/behave/model.py:381)\n  runner.context.tags = set(self.effective_tags)\nLOG_INFO:core.use_cases.process_receipt: Starting receipt analysis\nLOG_INFO:core.use_cases.process_receipt: Starting receipt analysis\nLOG_INFO:core.use_cases.process_receipt: Cleared scanned folder\nLOG_INFO:core.use_cases.process_receipt: Found 0 hashes in imported folder\nLOG_INFO:core.use_cases.process_receipt: Found 0 hashes in scanned folder\nLOG_INFO:core.use_cases.process_receipt: Receipt analysis completed - processed: 3, duplicates: 0, errors: 0\nLOG_INFO:core.use_cases.process_receipt: Starting receipt analysis\nLOG_INFO:core.use_cases.process_receipt: Removed existing receipts.csv\nLOG_INFO:core.use_cases.process_receipt: Cleared scanned folder\nLOG_INFO:core.use_cases.process_receipt: Found 0 hashes in imported folder\nLOG_INFO:core.use_cases.process_receipt: Found 0 hashes in scanned folder\nLOG_INFO:core.use_cases.process_receipt: Receipt analysis completed - processed: 2, duplicates: 0, errors: 0\nLOG_INFO:core.use_cases.process_receipt: Starting receipt analysis\nLOG_INFO:core.use_cases.process_receipt: Cleared scanned folder\nLOG_INFO:core.use_cases.process_receipt: Found 0 hashes in imported folder\nLOG_INFO:core.use_cases.process_receipt: Found 0 hashes in scanned folder\nLOG_INFO:core.use_cases.process_receipt: Receipt analysis completed - processed: 3, duplicates: 0, errors: 0\nLOG_INFO:core.use_cases.process_receipt: Starting receipt analysis\ntests/bdd/steps/tui_steps.py:110: ContextMaskWarning: user code is masking context attribute 'config' originally set by behave\n  context.config = config\ntests/bdd/steps/tui_steps.py:56: ContextMaskWarning: user code is masking context attribute 'config' originally set by behave\n  context.config = config\ntests/bdd/steps/view_staging_table_steps.py:29: ContextMaskWarning: user code is masking context attribute 'config' originally set by behave\n  context.config = Mock(spec=AppConfig)\ntests/bdd/steps/view_staging_table_steps.py:57: ContextMaskWarning: user code is masking context attribute 'config' originally set by behave\n  context.config = Mock(spec=AppConfig)\ntests/bdd/steps/view_staging_table_steps.py:100: ContextMaskWarning: user code is masking context attribute 'config' originally set by behave\n  context.config = Mock(spec=AppConfig)\ntests/bdd/steps/view_staging_table_steps.py:125: ContextMaskWarning: user code is masking context attribute 'config' originally set by behave\n  context.config = Mock(spec=AppConfig)\n"
    }
  },
  "overall_success": false
}